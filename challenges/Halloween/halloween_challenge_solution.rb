###############################################################################
# Title:  Halloween Challenge Solution
# Author: 143crimson
# Date:   2023/10/23
#
# This challenge involves deciphering a mysterious message, which,
# when successfully decrypted,reveals a spooky poem.
#
# The poem can be recovered straightforwardly by iterating over each line
# of the encrypted message and building the poem char by char.
#
# The board enciphers a character into one of two possible representations.
# If a character is found on the top row, the character is enciphered into the
# corresponding column number. Any other row and the character is enciphered
# into the corresponding row emoji and the column number.
#
# For example, "RUBY" is enciphered as "3ğŸ¬4ğŸƒ04".
# R => 3, U => ğŸ¬4, B => ğŸƒ0, Y => 4
#
# Undoing this process yields the poem.
###############################################################################
BOARD = [' ', '0', '1', '2', '3', '4', '5', '6'],
        [' ', 'S', 'C', 'A', 'R', 'Y', '?', '!'],
        ['ğŸƒ', 'B', 'D', 'E', 'F', 'G', 'H', ' '],
        ['ğŸ‘»', 'I', 'J', 'K', 'L', 'M', 'N', "'"],
        ['ğŸ¬', 'O', 'P', 'Q', 'T', 'U', 'V', ','],
        ['ğŸ’€', 'W', 'X', 'Z', '.', '#', '$', ':']

message = DATA.readlines(chomp: true)

# Transform the message line by line. Each line walked in a "one-pointer"
# style. If an emoji is read, then read the next char to get the column.
# Otherwise, the row is the first and the column is the read value plus one.
# The "pointer" is advanced accordingly to find the next char.
poem = message.map do |line|
  decoded = ""

  i = 0
  while i < line.length
    case line[i]
    when 'ğŸƒ' then decoded << BOARD[2][line[i+1].to_i + 1]; i += 2
    when 'ğŸ‘»' then decoded << BOARD[3][line[i+1].to_i + 1]; i += 2
    when 'ğŸ¬' then decoded << BOARD[4][line[i+1].to_i + 1]; i += 2
    when 'ğŸ’€' then decoded << BOARD[5][line[i+1].to_i + 1]; i += 2
    else           decoded << BOARD[1][line[i+0].to_i + 1]; i += 1
    end
  end

  decoded
end

# The hidden message is found by reading the first character on each line.
hidden = poem.collect { _1[0] || " "}.join

puts poem
puts
puts "Hidden Message: #{hidden}"

__END__
3ğŸ¬4ğŸƒ04ğŸƒ6ğŸ‘»00ğŸƒ62ğŸƒ6ğŸ‘»32ğŸ‘»5ğŸƒ4ğŸ¬42ğŸƒ4ğŸƒ2ğŸƒ6ğŸ¬3ğŸƒ52ğŸ¬3ğŸƒ6ğŸ’€0ğŸƒ2ğŸƒ6ğŸ¬13ğŸ¬0ğŸƒ432ğŸ‘»4ğŸ‘»4ğŸƒ230ğŸƒ62ğŸƒ1ğŸ¬03ğŸƒ2ğŸ¬6
ğŸ¬4ğŸ‘»5ğŸ‘»3ğŸƒ220ğŸƒ5ğŸ‘»0ğŸ‘»5ğŸƒ4ğŸƒ6ğŸ‘»42ğŸƒ4ğŸ‘»01ğŸƒ60ğŸ¬1ğŸƒ2ğŸ‘»3ğŸ‘»30ğŸƒ6ğŸ’€0ğŸ‘»0ğŸ¬3ğŸƒ5ğŸ‘»0ğŸ‘»5ğŸƒ6ğŸ‘»0ğŸ¬30ğŸƒ61ğŸ¬0ğŸƒ1ğŸƒ2ğŸƒ6ğŸƒ42ğŸ‘»3ğŸ¬03ğŸƒ2ğŸ’€3
ğŸƒ0ğŸƒ2ğŸ‘»5ğŸƒ22ğŸ¬3ğŸƒ5ğŸƒ6ğŸ¬3ğŸƒ5ğŸƒ2ğŸƒ6ğŸƒ52ğŸ¬4ğŸ‘»5ğŸ¬3ğŸƒ2ğŸƒ1ğŸƒ6ğŸ‘»4ğŸ¬0ğŸ¬0ğŸ‘»5ğŸ¬6ğŸƒ6ğŸ‘»0ğŸ¬30ğŸƒ604ğŸ‘»5ğŸ¬32ğŸ’€1ğŸƒ6ğŸ’€0ğŸƒ2ğŸƒ6ğŸƒ2ğŸ’€1ğŸ¬1ğŸ‘»3ğŸ¬03ğŸƒ2ğŸ¬6
4ğŸƒ2ğŸ¬3ğŸƒ6ğŸ‘»0ğŸ‘»5ğŸƒ6ğŸ¬3ğŸƒ5ğŸƒ2ğŸƒ6ğŸ’€0ğŸ¬03ğŸ‘»3ğŸƒ1ğŸƒ6ğŸ¬0ğŸƒ3ğŸƒ6ğŸ¬13ğŸ¬0ğŸƒ432ğŸ‘»4ğŸ‘»4ğŸ‘»0ğŸ‘»5ğŸƒ4ğŸ¬6ğŸƒ6ğŸ‘»0ğŸ¬3ğŸƒ6ğŸ¬3ğŸƒ53ğŸ‘»0ğŸ¬5ğŸƒ20ğŸƒ6ğŸƒ2ğŸ¬5ğŸƒ2ğŸ‘»5ğŸƒ6ğŸ‘»4ğŸ¬03ğŸƒ2ğŸ’€3

ğŸ‘»0ğŸ‘»5ğŸƒ6ğŸ¬3ğŸƒ5ğŸƒ2ğŸƒ6134ğŸ¬1ğŸ¬3ğŸ‘»01ğŸƒ6ğŸ‘»4ğŸƒ2ğŸ¬3ğŸƒ5ğŸ¬0ğŸƒ10ğŸ¬6ğŸƒ6ğŸ’€0ğŸƒ5ğŸƒ23ğŸƒ2ğŸƒ6ğŸƒ2ğŸƒ23ğŸ‘»0ğŸƒ2ğŸƒ6ğŸƒ0ğŸ¬4ğŸƒ40ğŸƒ6ğŸ‘»424ğŸƒ6ğŸ¬33ğŸƒ22ğŸƒ1ğŸ¬6
0ğŸ‘»2ğŸƒ2ğŸ‘»3ğŸƒ2ğŸ¬3ğŸ¬0ğŸ‘»50ğŸƒ6ğŸ¬0ğŸƒ3ğŸƒ6ğŸƒ233ğŸ¬030ğŸƒ6ğŸ‘»0ğŸ‘»5ğŸƒ6ğŸ¬3ğŸƒ5ğŸƒ2ğŸƒ6ğŸƒ123ğŸ‘»2ğŸƒ623ğŸƒ2ğŸƒ6ğŸ’€0ğŸ‘»0ğŸƒ1ğŸƒ20ğŸ¬13ğŸƒ22ğŸƒ1ğŸ’€3

ğŸ‘»5ğŸ¬0ğŸ¬3ğŸƒ62ğŸƒ6ğŸ‘»32ğŸ‘»5ğŸƒ4ğŸ¬42ğŸƒ4ğŸƒ2ğŸƒ6ğŸ¬0ğŸƒ3ğŸƒ6ğŸ¬3ğŸƒ5ğŸƒ2ğŸƒ6ğŸ¬120ğŸ¬3ğŸ¬6ğŸƒ6ğŸƒ0ğŸ¬4ğŸ¬3ğŸƒ6ğŸ¬0ğŸ‘»5ğŸƒ2ğŸƒ6ğŸ’€0ğŸƒ2ğŸƒ6ğŸƒ5ğŸ¬0ğŸ‘»3ğŸƒ1ğŸƒ6ğŸ¬0ğŸ¬43ğŸƒ6ğŸƒ5ğŸƒ22ğŸƒ10ğŸ¬6
ğŸ¬0ğŸ¬5ğŸƒ23ğŸƒ61ğŸ¬0ğŸ¬4ğŸ‘»5ğŸ¬3ğŸ‘»3ğŸƒ200ğŸƒ6ğŸ¬13ğŸ¬0ğŸ‘»1ğŸƒ21ğŸ¬30ğŸ¬6ğŸƒ6ğŸ’€0ğŸƒ5ğŸƒ23ğŸƒ2ğŸƒ6ğŸ‘»0ğŸ¬30ğŸƒ6ğŸ¬1ğŸ¬0ğŸ’€0ğŸƒ23ğŸƒ6ğŸƒ520ğŸƒ60ğŸ¬13ğŸƒ22ğŸƒ1ğŸ’€3
ğŸ¬3ğŸƒ5ğŸƒ2ğŸƒ6ğŸ¬33ğŸ‘»01ğŸ‘»20ğŸƒ62ğŸ‘»5ğŸƒ1ğŸƒ6ğŸ¬33ğŸƒ22ğŸ¬30ğŸƒ6ğŸ¬0ğŸƒ3ğŸƒ63ğŸ¬4ğŸƒ04ğŸ¬6ğŸƒ6ğŸ‘»3ğŸ‘»0ğŸ‘»2ğŸƒ2ğŸƒ6ğŸ’€0ğŸ‘»0ğŸ¬31ğŸƒ5ğŸƒ20ğŸ‘»6ğŸƒ61ğŸƒ523ğŸ‘»40ğŸ¬6ğŸƒ61ğŸ¬0ğŸ‘»5ğŸ¬5ğŸƒ2ğŸ‘»5ğŸƒ2ğŸ¬6

ğŸƒ132ğŸ’€0ğŸ‘»0ğŸ‘»5ğŸƒ4ğŸƒ6ğŸ¬40ğŸƒ6ğŸ‘»0ğŸ‘»5ğŸ¬3ğŸ¬0ğŸƒ6ğŸ‘»0ğŸ¬30ğŸƒ6ğŸ’€0ğŸ¬03ğŸ‘»3ğŸƒ1ğŸ¬6ğŸƒ6ğŸ’€0ğŸƒ5ğŸƒ23ğŸƒ2ğŸƒ6ğŸ¬3ğŸƒ5ğŸƒ2ğŸƒ60ğŸ¬4ğŸƒ0ğŸ‘»3ğŸ‘»0ğŸ‘»4ğŸƒ2ğŸƒ6ğŸ‘»00ğŸƒ60ğŸƒ2ğŸƒ2ğŸ‘»5ğŸ’€3
ğŸƒ2ğŸ‘»51ğŸƒ52ğŸ‘»5ğŸ¬3ğŸ‘»0ğŸ‘»5ğŸƒ4ğŸƒ6ğŸ¬40ğŸƒ6ğŸ’€0ğŸ‘»0ğŸ¬3ğŸƒ5ğŸƒ6ğŸƒ4ğŸƒ2ğŸ‘»40ğŸ¬6ğŸƒ6ğŸ‘»0ğŸ¬3ğŸ‘»60ğŸƒ6ğŸƒ2ğŸ¬5ğŸƒ234ğŸƒ61ğŸ¬0ğŸƒ1ğŸƒ23ğŸ‘»60ğŸƒ6ğŸƒ13ğŸƒ22ğŸ‘»4ğŸ¬6
2ğŸƒ1ğŸ¬5ğŸƒ2ğŸ‘»5ğŸ¬3ğŸ¬43ğŸƒ20ğŸƒ6ğŸ‘»0ğŸ‘»5ğŸƒ6ğŸ¬3ğŸƒ5ğŸƒ2ğŸƒ61ğŸ¬0ğŸƒ1ğŸƒ2ğŸ¬6ğŸƒ6ğŸ’€0ğŸƒ5ğŸƒ23ğŸƒ2ğŸƒ6ğŸ¬3ğŸƒ5ğŸƒ2ğŸƒ6ğŸƒ2ğŸƒ23ğŸ‘»0ğŸƒ2ğŸ‘»60ğŸƒ63ğŸ¬0ğŸ¬4ğŸ¬3ğŸ‘»0ğŸ‘»5ğŸƒ2ğŸ’€3
ğŸƒ1ğŸƒ22ğŸ¬3ğŸƒ5ğŸƒ6ğŸ‘»424ğŸƒ60ğŸƒ2ğŸƒ2ğŸ‘»4ğŸƒ6ğŸ¬3ğŸ¬0ğŸƒ6ğŸ‘»3ğŸ¬43ğŸ‘»2ğŸ¬6ğŸƒ6ğŸƒ0ğŸ¬4ğŸ¬3ğŸƒ6ğŸƒ3ğŸ¬03ğŸƒ63ğŸ¬4ğŸƒ04ğŸƒ6ğŸ‘»0ğŸ¬3ğŸ‘»60ğŸƒ6ğŸƒ52ğŸ‘»3ğŸ‘»3ğŸ¬0ğŸ’€0ğŸƒ2ğŸƒ2ğŸ‘»56
